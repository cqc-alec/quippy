@@grammar :: Quipper
@@whitespace :: /[^\S\n]*/

start::Program = input:iostatement newline statements:{statement newline} output:iostatement [newline] $ ;

iostatement::IOStatement = ("Inputs"|"Outputs")":" qubits:",".{ioqubit}+ ;
ioqubit = @:int ":" "Qbit" ;

statement
    =
    | qgate
    | qrot
    | comment
    ;

qgate::QGate = "QGate[" ~ name:string "]" inverse:["*"] "(" qubit:int ") with" controlled:(controlled | no_control) ;
qrot::QRot = "QRot[" ~ string "," double "](" int ")" ;

comment::Comment = "Comment[" ~ text:string "](" wires:",".{wire}+ ")" ;
wire::Wire = qubit:int ":" text:string ;

controlled::Controlled = "controls=[" ~ control:control "] with nocontrol" ;
no_control::NoControl = "nocontrol" ;

control::Control
    =
    | direction:"-" qubit:int
    | direction:"+" qubit:int
    ;

string = '"'@:String_literal'"';
String_literal::str = /[^"]+/ ;
int::int = /\d+/ ;
double::float = /(-)?\d+\.\d+e(-)?\d\d/ ;
newline = /\n/ ;
